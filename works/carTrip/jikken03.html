<!DOCTYPE html>
<html lang="jp">
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://pyscript.net/alpha/pyscript.css" />
    <script defer src="https://pyscript.net/alpha/pyscript.js"></script>
    <title>PyScript-Demo</title>
    <py-env>
        - numpy
        - matplotlib    
    </py-env>
    
</head>
<body>
    <div id="hello"></div>
    <input id="numbers" type="range" min="0" max="10" step="1">
    <br>
    <input type="button" value="click_me" id="btn">
    <div id="num"></div>
    <div id="plt"></div>
    <py-script>
    import pyodide
    import numpy as np
    import matplotlib.pyplot as plt

    pyscript.write("hello","Hello to div tag")
    print("Hello from PyScript")

    #グラフ
    def pyplots(val):
        x=np.arange(1,11)
        y=x**val
        fig,ax = plt.subplots()
        ax.plot(x,y)
        return fig

    doc_number=document.getElementById('numbers')
    def on_click(e):
        doc2=document.getElementById('num')
        doc2.innerHTML = doc_number.value
        #doc2.innerHTML = pyplots(float(doc_number.value))
            
    btn_element = document.getElementById('btn')
    btn_element.addEventListener('click', pyodide.create_proxy(on_click))

    pyscript.write("plt",pyplots(float(doc_number.value)))
    
    async def tick():
        while True:
            try:
                doc_number=document.getElementById('numbers')
                pyscript.write("num",doc_number.value)
                pyscript.write("plt", pyplots(float(doc_number.value)))
                await asyncio.sleep(0.03)
                
            except Exception as e:
                break

    pyscript.run_until_complete(tick())
    </py-script>
</body>
</html>